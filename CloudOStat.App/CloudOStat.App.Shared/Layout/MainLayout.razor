@inherits MainLayoutBase

<MudThemeProvider Theme="CloudOStatTheme.SmokerEmber" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />
<MudBreakpointProvider OnBreakpointChanged="HandleBreakpointChanged" />

<ErrorBoundary @ref="_errorBoundary">
    <ChildContent>
        <MudLayout>
            <MudAppBar Color="Color.Primary" Elevation="1">
                @if (!_isMobile)
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@(async () => await ToggleDrawer())" />
                }
                <MudText Typo="Typo.h6">CloudOStat</MudText>
            </MudAppBar>

            @if (!_isMobile)
            {
                <MudDrawer @bind-Open="_drawerOpen"
                           Variant="_drawerVariant"
                           Elevation="1"
                           Breakpoint="Breakpoint.Md"
                           ClipMode="DrawerClipMode.Always">
                    <NavMenu />
                </MudDrawer>
            }

            <MudMainContent Class="@(_isMobile ? "layout-main layout-main-mobile" : "layout-main")">
                <MudContainer MaxWidth="MaxWidth.False">
                    @Body
                </MudContainer>
            </MudMainContent>

            @if (_isMobile)
            {
                <BottomNav />
            }
        </MudLayout>
    </ChildContent>
    <ErrorContent Context="exception">
        <MudContainer Class="mt-8">
            <MudPaper Elevation="3" Class="pa-6">
                <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Class="mb-4">
                    <MudText Typo="Typo.h6">An error has occurred</MudText>
                </MudAlert>
                
                <MudText Typo="Typo.body1" Class="mb-4">
                    The application encountered an unexpected error. Please try refreshing the page.
                </MudText>
                
                <MudText Typo="Typo.body2" Color="Color.Error" Class="mb-4">
                    @exception.Message
                </MudText>
                
                <MudStack Row="true" Spacing="2">
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="RecoverFromError">
                        Try Again
                    </MudButton>
                    <MudButton Variant="Variant.Outlined" Color="Color.Default" OnClick="() => _showStackTrace = !_showStackTrace">
                        @(_showStackTrace ? "Hide" : "Show") Details
                    </MudButton>
                </MudStack>
                
                @if (_showStackTrace)
                {
                    <MudPaper Class="mt-4 pa-4" Elevation="0" Style="background-color: #1e1e1e; color: #d4d4d4; font-family: 'Consolas', monospace; font-size: 12px; overflow-x: auto;">
                        <pre style="margin: 0; white-space: pre-wrap;">@exception.ToString()</pre>
                    </MudPaper>
                }
            </MudPaper>
        </MudContainer>
    </ErrorContent>
</ErrorBoundary>

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>
